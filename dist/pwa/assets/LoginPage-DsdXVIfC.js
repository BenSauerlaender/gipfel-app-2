import{Q as q}from"./QCardSection-hbXFI8Kn.js";import{Q as P}from"./QInput-CK6CjM5w.js";import{c as F,r as f,Z as A,_ as R,D as I,g as U,h as k,e as D,aR as L,B,C as N,J as $,aX as j,$ as M,a as O,a4 as E,U as c,S,u as T,R as Q,a0 as X,aY as z,T as J,X as K,a3 as Y}from"./index-D5dlIUyy.js";import{a as Z}from"./focus-manager-BJWzFvJg.js";import{Q as G}from"./QCard-BS_7SdRC.js";import"./use-key-composition-DHurTuA_.js";import"./private.use-form-tzj63TXQ.js";const H=F({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(l,{slots:m,emit:i}){const v=U(),n=f(null);let a=0;const o=[];function y(e){const d=typeof e=="boolean"?e:l.noErrorFocus!==!0,h=++a,_=(t,s)=>{i(`validation${t===!0?"Success":"Error"}`,s)},w=t=>{const s=t.validate();return typeof s.then=="function"?s.then(u=>({valid:u,comp:t}),u=>({valid:!1,comp:t,err:u})):Promise.resolve({valid:s,comp:t})};return(l.greedy===!0?Promise.all(o.map(w)).then(t=>t.filter(s=>s.valid!==!0)):o.reduce((t,s)=>t.then(()=>w(s).then(u=>{if(u.valid===!1)return Promise.reject(u)})),Promise.resolve()).catch(t=>[t])).then(t=>{if(t===void 0||t.length===0)return h===a&&_(!0),!0;if(h===a){const{comp:s,err:u}=t[0];if(u!==void 0&&console.error(u),_(!1,s),d===!0){const V=t.find(({comp:C})=>typeof C.focus=="function"&&L(C.$)===!1);V!==void 0&&V.comp.focus()}}return!1})}function b(){a++,o.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function x(e){e!==void 0&&B(e);const d=a+1;y().then(h=>{d===a&&h===!0&&(l.onSubmit!==void 0?i("submit",e):e?.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function g(e){e!==void 0&&B(e),i("reset"),N(()=>{b(),l.autofocus===!0&&l.noResetFocus!==!0&&r()})}function r(){Z(()=>{if(n.value===null)return;(n.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||n.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||n.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(n.value.querySelectorAll("[tabindex]"),d=>d.tabIndex!==-1))?.focus({preventScroll:!0})})}$(j,{bindComponent(e){o.push(e)},unbindComponent(e){const d=o.indexOf(e);d!==-1&&o.splice(d,1)}});let p=!1;return A(()=>{p=!0}),R(()=>{p===!0&&l.autofocus===!0&&r()}),I(()=>{l.autofocus===!0&&r()}),Object.assign(v.proxy,{validate:y,resetValidation:b,submit:x,reset:g,focus:r,getValidationComponents:()=>o}),()=>k("form",{class:"q-form",ref:n,onSubmit:x,onReset:g},D(m.default))}}),W={class:"q-pa-md flex flex-center column",style:{"min-height":"100vh"}},ee={key:0,class:"text-negative q-mb-md"},te={__name:"LoginPage",setup(l){const m=f(""),i=f(""),v=f(""),n=f(!1),a=f(""),o=f(""),y=O(),b=T();async function x(){if(v.value="",a.value="",o.value="",!m.value){a.value="Username is required.";return}if(!i.value){o.value="Password is required.";return}n.value=!0;try{await y.login(m.value,i.value),b.push("/status")}catch(g){v.value=g.message||"Login failed."}finally{n.value=!1}}return(g,r)=>(Q(),E("div",W,[c(G,{class:"q-pa-lg",style:{width:"350px","max-width":"90vw"}},{default:S(()=>[c(q,null,{default:S(()=>r[2]||(r[2]=[X("div",{class:"text-h6"},"Anmelden",-1)])),_:1,__:[2]}),c(q,null,{default:S(()=>[c(H,{onSubmit:z(x,["prevent"]),class:"q-gutter-md"},{default:S(()=>[c(P,{filled:"",modelValue:m.value,"onUpdate:modelValue":r[0]||(r[0]=p=>m.value=p),label:"Benutzername",error:!!a.value,"error-message":a.value,autocomplete:"username"},null,8,["modelValue","error","error-message"]),c(P,{filled:"",modelValue:i.value,"onUpdate:modelValue":r[1]||(r[1]=p=>i.value=p),label:"Passwort",type:"password",error:!!o.value,"error-message":o.value,autocomplete:"current-password"},null,8,["modelValue","error","error-message"]),v.value?(Q(),E("div",ee,K(v.value),1)):J("",!0),c(Y,{type:"submit",color:"primary",label:"Anmelden",loading:n.value,class:"full-width"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]))}},de=M(te,[["__scopeId","data-v-d2379cb1"]]);export{de as default};
